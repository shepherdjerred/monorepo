import { recommended } from "../eslint-config/local.ts";

export default [
  ...recommended({ tsconfigRootDir: import.meta.dirname }),
  { rules: { "no-console": "off" } },
  // CDK8s infrastructure code uses heavily untyped APIs (cdk8s-plus, Helm values, etc.)
  {
    files: ["src/cdk8s/**/*.ts"],
    rules: {
      "@typescript-eslint/no-unsafe-call": "off",
      "@typescript-eslint/no-unsafe-member-access": "off",
      "@typescript-eslint/no-unsafe-assignment": "off",
      "@typescript-eslint/no-unsafe-argument": "off",
      "@typescript-eslint/no-unsafe-return": "off",
      "@typescript-eslint/restrict-template-expressions": "off",
      "@typescript-eslint/restrict-plus-operands": "off",
      // 1Password vault references and infrastructure URLs trigger false positives
      "no-secrets/no-secrets": "off",
      // CDK8s/Helm value code uses nullable strings for optional config fields
      "@typescript-eslint/strict-boolean-expressions": ["error", { allowNullableString: true, allowNullableBoolean: true, allowAny: true }],
      // CDK8s resource definitions and K8s manifests are inherently large/deep
      "max-lines": ["error", { max: 800, skipBlankLines: false, skipComments: false }],
      "max-lines-per-function": ["error", { max: 500, skipBlankLines: true, skipComments: true }],
      "max-depth": ["error", { max: 6 }],
      "max-params": ["error", { max: 8 }],
    },
  },
  // Grafana dashboard builders have inherent complexity from dashboard definitions
  {
    files: ["src/cdk8s/grafana/**/*.ts"],
    rules: {
      "max-lines": ["error", { max: 800, skipBlankLines: false, skipComments: false }],
      "max-lines-per-function": ["error", { max: 600, skipBlankLines: true, skipComments: true }],
      "max-params": ["error", { max: 8 }],
      // Dashboard builder helpers don't use closure variables but are logically scoped
      "unicorn/consistent-function-scoping": "off",
    },
  },
  // CDK8s monitoring rules are declarative definitions
  {
    files: ["src/cdk8s/src/resources/monitoring/**/*.ts"],
    rules: {
      "max-lines": ["error", { max: 600, skipBlankLines: false, skipComments: false }],
      "max-lines-per-function": ["error", { max: 500, skipBlankLines: true, skipComments: true }],
      "max-params": ["error", { max: 8 }],
    },
  },
  // Home Assistant workflows use @digital-alchemy/core which has untyped APIs
  {
    files: ["src/ha/**/*.ts", "src/ha/**/*.mts"],
    rules: {
      "@typescript-eslint/no-unsafe-call": "off",
      "@typescript-eslint/no-unsafe-return": "off",
      "@typescript-eslint/no-unsafe-assignment": "off",
      // Zod .catch() is falsely flagged as Promise .catch()
      "custom-rules/prefer-async-await": "off",
    },
  },
  // HA workflow files interact with @digital-alchemy entities that return `any`
  {
    files: ["src/ha/src/workflows/**/*.ts"],
    rules: {
      "@typescript-eslint/strict-boolean-expressions": "off",
    },
  },
  // Barrel/index files that re-export public API surface
  {
    files: [
      "**/index.ts",
      "src/helm-types/src/helm-types.ts",
    ],
    rules: {
      "custom-rules/no-re-exports": "off",
    },
  },
  // helm-types is a complex YAML/regex parser â€” needs relaxed structural limits
  {
    files: ["src/helm-types/**/*.ts"],
    rules: {
      complexity: ["error", { max: 50 }],
      "max-depth": ["error", { max: 6 }],
      "max-lines": ["error", { max: 800, skipBlankLines: false, skipComments: false }],
      "max-lines-per-function": ["error", { max: 500, skipBlankLines: true, skipComments: true }],
      "max-params": ["error", { max: 8 }],
      // YAML parser uses regex with capturing groups for structure that it processes positionally
      "regexp/no-unused-capturing-group": "off",
      "regexp/no-super-linear-backtracking": "off",
      // YAML/regex parser code uses string truthiness checks idiomatically
      "@typescript-eslint/strict-boolean-expressions": ["error", { allowString: true, allowNullableString: true, allowNullableBoolean: true, allowAny: true }],
    },
  },
  // deps-email has complex chart parsing and email formatting logic
  {
    files: ["src/deps-email/**/*.ts"],
    rules: {
      complexity: ["error", { max: 30 }],
      "max-depth": ["error", { max: 6 }],
      "max-params": ["error", { max: 8 }],
      "max-lines": ["error", { max: 800, skipBlankLines: false, skipComments: false }],
      // Version string parsing uses positional captures
      "regexp/no-unused-capturing-group": "off",
      // Email template code uses nullable strings idiomatically for optional fields
      "@typescript-eslint/strict-boolean-expressions": ["error", { allowNullableString: true, allowNullableBoolean: true, allowAny: true }],
    },
  },
  {
    ignores: [
      "src/talos/",
      "src/*/eslint.config.ts",
      "scripts/",
      "eslint.config.ts",
      // Generated by digital-alchemy type-writer
      "src/ha/src/hass/",
    ],
  },
];
